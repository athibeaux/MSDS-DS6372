---
title: "Proj1"
author: "Thibeaux"
date: "2023-06-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Loading Libraries
```{r}
library(GGally)
library(boot)
library(ggplot2)
library(tidyverse)
library(lmboot)
library(caret)
library(naniar)
library(utils)
library(stats)
library(corrplot)
```

##Reading in Dataset
```{r}
life = read.csv('https://github.com/athibeaux/MSDS-DS6372/raw/main/Life_Expectancy.csv')
```
```{r}
ggplot(data = life) + geom_point(mapping = aes(x = GDP, y = Life.expectancy))
```
##Upon looking at the graph of the original data set, it appears that there needs to be a log transformation on the X or the GDP as we are interested in seeing the relation between Life Expenctancy and GDP. 

##Checking Data Types
```{r}
str(life)
vis_miss(life)
dim(life)
View(life)
```

#Imputing using Median
```{r}
#GDP 15% [17]  keep GDP to have it Imputed even if quite high percentage, assuming it is crucial to predicting Life.expectancy as richer countries have better health access/Medicine and tech. The numbers appear to be GDP per capita which helps as it addresses GDP/Population. GDP per Capita and Population would be too closely related and prob attribute to covariance.  

#Adjusting text angle to vis_miss
imputeMedian= preProcess(life[,-c(1:4,9)],method="medianImpute") #predictors 1:3, 9, 17 and response is 4
cleandataMedian = predict(imputeMedian,newdata=life)
dim(cleandataMedian)
vis_miss(cleandataMedian) + theme(axis.text.x = element_text(angle = 90, hjust = 0))

#Literature says that over 10% missing data can contribute to bias 
#HepatitsB [9] at 19% , Population 22% [18]. 
#Removing columns 9 and 18
cleandataMedian = cleandataMedian[,-c(18,9)]
vis_miss(cleandataMedian) + theme(axis.text.x = element_text(angle = 90, hjust = 0))

#removing last NA
cleandataMedian = na.omit(cleandataMedian)
vis_miss(cleandataMedian) + theme(axis.text.x = element_text(angle = 90, hjust = 0))

```

Before and after log transforming GDP, with cleandataMedian:
```{r}
ggplot(data = cleandataMedian) + geom_point(mapping = aes(x = GDP, y = Life.expectancy))

#Log transformation on GDP 
ggplot(data = cleandataMedian) + geom_point(mapping = aes(x = log(GDP), y = Life.expectancy))

```

#Imputing and Removing
```{r}
#Imputing all save for columns 1:4 and Removing last Na in 
imputeMedian= preProcess(life[,-c(1:4)],method="medianImpute") #predictors 1:4 and response is 4
cleandataMedian1 = predict(imputeMedian,newdata=life)
dim(cleandataMedian1)
vis_miss(cleandataMedian1) + theme(axis.text.x = element_text(angle = 90, hjust = 0))

#removing last NA <0,1% 
cleandataMedian1 = na.omit(cleandataMedian1)
vis_miss(cleandataMedian1) + theme(axis.text.x = element_text(angle = 90, hjust = 0))
dim(cleandataMedian1)

```

Before and after log transforming GDP, using cleandatamedian1
```{r}
ggplot(data = cleandataMedian1) + geom_point(mapping = aes(x = GDP, y = Life.expectancy))

#log transformation on GDP 
ggplot(data = cleandataMedian1) + geom_point(mapping = aes(x = log(GDP), y = Life.expectancy))

```

##Correlation Matrix:
```{r}
cor <- cor(cleandataMedian[,c(4,5:20)])
corrplot(cor, method = "square",  tl.srt = 50, tl.col = "black", tl.cex = 0.6, title = "Correlation of Variables", mar=c(0,0,1,0))
```
GGPairs:
```{r}
#commented out for knitting
#ggpairs(cleandataMedian[,4:20])
```
Create categorical variable from year:
```{r}

summary(cleandataMedian$Year)

#Labeled the breaks in years into 2 year buckets
cleandataMedian$DualYears <- cut(as.numeric(cleandataMedian$Year), breaks=c(0, 2001, 2003, 2005, 2007, 2009, 2011, 2013, 2015), labels=c('2000-2001', '2002-2003', '2004-2005', '2006-2007', '2008-2009', '2010-2011','2012-2013','2014-2015'))

cleandataMedian %>% ggplot() + geom_bar(aes(x = DualYears))

summary(cleandataMedian$DualYears)
```

